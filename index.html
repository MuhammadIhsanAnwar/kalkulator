<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Ilmiah</title>
    <!-- Pengaturan Tampilan HTML dengan CSS -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            background-color: rgb(36, 36, 36);
        }
        
        header {
            background: linear-gradient(to top, #0E9A8A, #006156);
            padding: 20px;
            font-family: Arial;
            color: #ffffff;
            text-align: center;
        }
        
        body {
            line-height: 1.5;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #ffffff;
            padding: 20px;
        }
        
        footer {
            background: linear-gradient(to bottom, #0E9A8A, #006156);
            padding: 15px;
            text-align: center;
            font-family: Arial;
            color: #ffffff;
            margin-top: 40px;
        }
        
        .android, .windows {
            display: none;
        }
        
        .calculator-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
        }
        
        .calculator {
            background: #1e1e1e;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.7);
            width: 100%;
            max-width: 500px;
        }
        
        .display {
            background: #2a2a2a;
            border: 2px solid #0E9A8A;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: right;
            min-height: 60px;
        }
        
        .display-input {
            font-size: 18px;
            color: #0E9A8A;
            word-wrap: break-word;
            word-break: break-all;
            min-height: 25px;
        }
        
        .display-output {
            font-size: 28px;
            color: #ffffff;
            font-weight: bold;
            margin-top: 5px;
            min-height: 35px;
        }
        
        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .button-row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }
        
        button {
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .btn-number {
            background: #333333;
            color: #ffffff;
        }
        
        .btn-number:hover {
            background: #444444;
        }
        
        .btn-operator {
            background: #0E9A8A;
            color: #ffffff;
        }
        
        .btn-operator:hover {
            background: #0d8578;
        }
        
        .btn-function {
            background: #8B5CF6;
            color: #ffffff;
            font-size: 12px;
        }
        
        .btn-function:hover {
            background: #7c3aed;
        }
        
        .btn-special {
            background: #EF4444;
            color: #ffffff;
        }
        
        .btn-special:hover {
            background: #dc2626;
        }
        
        .btn-clear {
            background: #F97316;
            color: #ffffff;
        }
        
        .btn-clear:hover {
            background: #ea580c;
        }
        
        .btn-equals {
            background: #10b981;
            color: #ffffff;
            grid-column: span 2;
        }
        
        .btn-equals:hover {
            background: #059669;
        }
        
        .full-width {
            grid-column: span 5;
        }
        
        .nav-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .nav-btn {
            background: #6366f1;
            color: #ffffff;
            padding: 10px;
            text-decoration: none;
            border-radius: 6px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .nav-btn:hover {
            background: #4f46e5;
            transform: translateY(-2px);
        }
        
        @media (max-width: 600px) {
            .calculator {
                max-width: 100%;
                padding: 15px;
            }
            
            button {
                padding: 10px;
                font-size: 12px;
            }
            
            .display-output {
                font-size: 24px;
            }
        }
    </style>
</head>

<body>
    <!-- Sesi Tampilan untuk Windows -->
    <div class="windows"> 
        <header>
            <h2>Kalkulator Ilmiah</h2>
        </header>
        
        <div class="calculator-container">
            <div class="calculator">
                <div class="display">
                    <div class="display-input" id="expression"></div>
                    <div class="display-output" id="result">0</div>
                </div>
                
                <div class="buttons-grid">
                    <!-- Row 1: Clear -->
                    <button class="btn-clear full-width" onclick="clearDisplay()">C (Clear)</button>
                    
                    <!-- Row 2: Trigonometry Functions -->
                    <button class="btn-function" onclick="appendFunction('sin')">sin</button>
                    <button class="btn-function" onclick="appendFunction('cos')">cos</button>
                    <button class="btn-function" onclick="appendFunction('tan')">tan</button>
                    <button class="btn-function" onclick="appendFunction('log')">log</button>
                    <button class="btn-function" onclick="appendFunction('ln')">ln</button>
                    
                    <!-- Row 3: Advanced Functions -->
                    <button class="btn-function" onclick="appendFunction('sqrt')">‚àö</button>
                    <button class="btn-function" onclick="appendOperator('^')">x^y</button>
                    <button class="btn-function" onclick="appendFunction('!')">!</button>
                    <button class="btn-operator" onclick="appendOperator('(')">(</button>
                    <button class="btn-operator" onclick="appendOperator(')')">)</button>
                    
                    <!-- Row 4: Constants & Utilities -->
                    <button class="btn-function" onclick="appendConstant('œÄ')">œÄ</button>
                    <button class="btn-function" onclick="appendConstant('e')">e</button>
                    <button class="btn-function" onclick="appendFunction('inv')">1/x</button>
                    <button class="btn-function" onclick="appendFunction('deg')">‚ÜíDEG</button>
                    <button class="btn-function" onclick="appendFunction('rad')">‚ÜíRAD</button>
                    
                    <!-- Row 5: Numbers & Division/Multiply -->
                    <button class="btn-number" onclick="appendNumber('7')">7</button>
                    <button class="btn-number" onclick="appendNumber('8')">8</button>
                    <button class="btn-number" onclick="appendNumber('9')">9</button>
                    <button class="btn-operator" onclick="appendOperator('/')">√∑</button>
                    <button class="btn-operator" onclick="appendOperator('*')">√ó</button>
                    
                    <!-- Row 6: Numbers & Subtract/Add -->
                    <button class="btn-number" onclick="appendNumber('4')">4</button>
                    <button class="btn-number" onclick="appendNumber('5')">5</button>
                    <button class="btn-number" onclick="appendNumber('6')">6</button>
                    <button class="btn-operator" onclick="appendOperator('-')">‚àí</button>
                    <button class="btn-operator" onclick="appendOperator('+')">+</button>
                    
                    <!-- Row 7: Numbers & Decimal -->
                    <button class="btn-number" onclick="appendNumber('1')">1</button>
                    <button class="btn-number" onclick="appendNumber('2')">2</button>
                    <button class="btn-number" onclick="appendNumber('3')">3</button>
                    <button class="btn-number" onclick="appendNumber('.')">.</button>
                    <button class="btn-number" onclick="appendNumber('¬±')">¬±</button>
                    
                    <!-- Row 8: Zero, Delete & Equals -->
                    <button class="btn-number" onclick="appendNumber('0')" style="grid-column: span 2;">0</button>
                    <button class="btn-special" onclick="deleteLastChar()">DEL</button>
                    <button class="btn-special" onclick="deleteLastChar()">‚å´</button>
                    <button class="btn-equals" onclick="calculate()">=</button>
                </div>
                
                <div class="nav-buttons">
                    <a href="index.html" class="nav-btn">‚Üê Kembali</a>
                    <button onclick="toggleHistory()" class="nav-btn" style="border: none; cursor: pointer;">üìã Riwayat</button>
                </div>
            </div>
        </div>
        
        <!-- History Panel -->
        <div id="historyPanel" style="display: none; position: fixed; right: 20px; top: 100px; background: #1e1e1e; border: 2px solid #0E9A8A; border-radius: 8px; padding: 15px; max-width: 300px; max-height: 400px; overflow-y: auto; box-shadow: 0 0 20px rgba(0,0,0,0.7);">
            <div style="margin-bottom: 10px; font-weight: bold; color: #0E9A8A;">Riwayat Perhitungan</div>
            <div id="historyList"></div>
            <button onclick="clearHistory()" class="btn-clear" style="width: 100%; margin-top: 10px; padding: 8px;">Hapus Riwayat</button>
        </div>
        
        <footer>
            <h6>&copy;2025 Kalkulator Ilmiah - Muhammad Ihsan Anwar 251402044 | All Rights Reserved</h6>
        </footer>
    </div>
    
    <!-- Sesi Tampilan untuk Android -->
    <div class="android">
        <header>
            <h2>Kalkulator Ilmiah</h2>
        </header>
        
        <div class="calculator-container">
            <div class="calculator">
                <div class="display">
                    <div class="display-input" id="expression-mobile"></div>
                    <div class="display-output" id="result-mobile">0</div>
                </div>
                
                <div class="buttons-grid">
                    <!-- Row 1: Memory & Clear -->
                    <button class="btn-clear full-width" onclick="clearDisplay()">C (Clear)</button>
                    
                    <!-- Row 2: Functions -->
                    <button class="btn-function" onclick="appendFunction('sin')">sin</button>
                    <button class="btn-function" onclick="appendFunction('cos')">cos</button>
                    <button class="btn-function" onclick="appendFunction('tan')">tan</button>
                    <button class="btn-function" onclick="appendFunction('log')">log</button>
                    <button class="btn-function" onclick="appendFunction('ln')">ln</button>
                    
                    <!-- Row 3: More Functions -->
                    <button class="btn-function" onclick="appendFunction('sqrt')">‚àö</button>
                    <button class="btn-function" onclick="appendOperator('^')">x^y</button>
                    <button class="btn-function" onclick="appendFunction('!')">!</button>
                    <button class="btn-operator" onclick="appendOperator('(')">(</button>
                    <button class="btn-operator" onclick="appendOperator(')')">)</button>
                    
                    <!-- Row 4: Constants -->
                    <button class="btn-function" onclick="appendConstant('œÄ')">œÄ</button>
                    <button class="btn-function" onclick="appendConstant('e')">e</button>
                    <button class="btn-function" onclick="appendFunction('inv')">Inv</button>
                    <button class="btn-special" onclick="deleteLastChar()">DEL</button>
                    
                    <!-- Row 5: Numbers & Basic Operators -->
                    <button class="btn-number" onclick="appendNumber('7')">7</button>
                    <button class="btn-number" onclick="appendNumber('8')">8</button>
                    <button class="btn-number" onclick="appendNumber('9')">9</button>
                    <button class="btn-operator" onclick="appendOperator('/')" >√∑</button>
                    <button class="btn-operator" onclick="appendOperator('*')">√ó</button>
                    
                    <!-- Row 6: Numbers & Operators -->
                    <button class="btn-number" onclick="appendNumber('4')">4</button>
                    <button class="btn-number" onclick="appendNumber('5')">5</button>
                    <button class="btn-number" onclick="appendNumber('6')">6</button>
                    <button class="btn-operator" onclick="appendOperator('-')">-</button>
                    <button class="btn-operator" onclick="appendOperator('+')">+</button>
                    
                    <!-- Row 7: Numbers -->
                    <button class="btn-number" onclick="appendNumber('1')">1</button>
                    <button class="btn-number" onclick="appendNumber('2')">2</button>
                    <button class="btn-number" onclick="appendNumber('3')">3</button>
                    <button class="btn-number" onclick="appendNumber('.')">.</button>
                    <button class="btn-number" onclick="appendNumber('¬±')">¬±</button>
                    
                    <!-- Row 8: Special Numbers -->
                    <button class="btn-number" onclick="appendNumber('0')" style="grid-column: span 2;">0</button>
                    <button class="btn-function" onclick="appendFunction('rad')">To RAD</button>
                    <button class="btn-function" onclick="appendFunction('deg')">To DEG</button>
                    <button class="btn-equals" onclick="calculate()">=</button>
                </div>
                
                <div class="nav-buttons">
                    <a href="index.html" class="nav-btn">‚Üê Kembali</a>
                    <button onclick="toggleHistory()" class="nav-btn" style="border: none; cursor: pointer;">üìã Riwayat</button>
                </div>
            </div>
        </div>
        
        <!-- History Panel -->
        <div id="historyPanel" style="display: none; position: fixed; right: 20px; top: 100px; background: #1e1e1e; border: 2px solid #0E9A8A; border-radius: 8px; padding: 15px; max-width: 300px; max-height: 400px; overflow-y: auto; box-shadow: 0 0 20px rgba(0,0,0,0.7);">
            <div style="margin-bottom: 10px; font-weight: bold; color: #0E9A8A;">Riwayat Perhitungan</div>
            <div id="historyList"></div>
            <button onclick="clearHistory()" class="btn-clear" style="width: 100%; margin-top: 10px; padding: 8px;">Hapus Riwayat</button>
        </div>
        
        <footer>
            <h6>&copy;2025 Kalkulator Ilmiah - Muhammad Ihsan Anwar 251402044 | All Rights Reserved</h6>
        </footer>
        <header>
            <h2>Kalkulator Ilmiah</h2>
        </header>
        
        <div class="calculator-container">
            <div class="calculator">
                <div class="display">
                    <div class="display-input" id="expression-mobile"></div>
                    <div class="display-output" id="result-mobile">0</div>
                </div>
                
                <div class="buttons-grid">
                    <!-- Row 1: Clear -->
                    <button class="btn-clear full-width" onclick="clearDisplay()">C (Clear)</button>
                    
                    <!-- Row 2: Trigonometry Functions -->
                    <button class="btn-function" onclick="appendFunction('sin')">sin</button>
                    <button class="btn-function" onclick="appendFunction('cos')">cos</button>
                    <button class="btn-function" onclick="appendFunction('tan')">tan</button>
                    <button class="btn-function" onclick="appendFunction('log')">log</button>
                    <button class="btn-function" onclick="appendFunction('ln')">ln</button>
                    
                    <!-- Row 3: Advanced Functions -->
                    <button class="btn-function" onclick="appendFunction('sqrt')">‚àö</button>
                    <button class="btn-function" onclick="appendOperator('^')">x^y</button>
                    <button class="btn-function" onclick="appendFunction('!')">!</button>
                    <button class="btn-operator" onclick="appendOperator('(')">(</button>
                    <button class="btn-operator" onclick="appendOperator(')')">)</button>
                    
                    <!-- Row 4: Constants & Utilities -->
                    <button class="btn-function" onclick="appendConstant('œÄ')">œÄ</button>
                    <button class="btn-function" onclick="appendConstant('e')">e</button>
                    <button class="btn-function" onclick="appendFunction('inv')">1/x</button>
                    <button class="btn-function" onclick="appendFunction('deg')">‚ÜíDEG</button>
                    <button class="btn-function" onclick="appendFunction('rad')">‚ÜíRAD</button>
                    
                    <!-- Row 5: Numbers & Division/Multiply -->
                    <button class="btn-number" onclick="appendNumber('7')">7</button>
                    <button class="btn-number" onclick="appendNumber('8')">8</button>
                    <button class="btn-number" onclick="appendNumber('9')">9</button>
                    <button class="btn-operator" onclick="appendOperator('/')">√∑</button>
                    <button class="btn-operator" onclick="appendOperator('*')">√ó</button>
                    
                    <!-- Row 6: Numbers & Subtract/Add -->
                    <button class="btn-number" onclick="appendNumber('4')">4</button>
                    <button class="btn-number" onclick="appendNumber('5')">5</button>
                    <button class="btn-number" onclick="appendNumber('6')">6</button>
                    <button class="btn-operator" onclick="appendOperator('-')">‚àí</button>
                    <button class="btn-operator" onclick="appendOperator('+')">+</button>
                    
                    <!-- Row 7: Numbers & Decimal -->
                    <button class="btn-number" onclick="appendNumber('1')">1</button>
                    <button class="btn-number" onclick="appendNumber('2')">2</button>
                    <button class="btn-number" onclick="appendNumber('3')">3</button>
                    <button class="btn-number" onclick="appendNumber('.')">.</button>
                    <button class="btn-number" onclick="appendNumber('¬±')">¬±</button>
                    
                    <!-- Row 8: Zero, Delete & Equals -->
                    <button class="btn-number" onclick="appendNumber('0')" style="grid-column: span 2;">0</button>
                    <button class="btn-special" onclick="deleteLastChar()">DEL</button>
                    <button class="btn-special" onclick="deleteLastChar()">‚å´</button>
                    <button class="btn-equals" onclick="calculate()">=</button>
                </div>
                
                <div class="nav-buttons">
                    <a href="index.html" class="nav-btn">‚Üê Kembali</a>
                    <button onclick="toggleHistory()" class="nav-btn" style="border: none; cursor: pointer;">üìã Riwayat</button>
                </div>
            </div>
        </div>
        
        <!-- History Panel -->
        <div id="historyPanel" style="display: none; position: fixed; right: 20px; top: 100px; background: #1e1e1e; border: 2px solid #0E9A8A; border-radius: 8px; padding: 15px; max-width: 300px; max-height: 400px; overflow-y: auto; box-shadow: 0 0 20px rgba(0,0,0,0.7);">
            <div style="margin-bottom: 10px; font-weight: bold; color: #0E9A8A;">Riwayat Perhitungan</div>
            <div id="historyList"></div>
            <button onclick="clearHistory()" class="btn-clear" style="width: 100%; margin-top: 10px; padding: 8px;">Hapus Riwayat</button>
        </div>
        
        <footer>
            <h6>&copy;2025 Kalkulator Ilmiah - Muhammad Ihsan Anwar 251402044 | All Rights Reserved</h6>
        </footer>
    </div>
    
    <!-- JavaScript untuk Kontrol Kalkulator -->
    <script>
        // State Variables
        let expression = '';
        let isRadianMode = true;
        let calculationHistory = [];
        
        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            updateDisplay();
            loadHistory();
        });
        
        // Append Number to Expression
        function appendNumber(num) {
            if (num === '¬±') {
                if (expression === '' || expression.endsWith('(') || expression.endsWith('+') || expression.endsWith('-') || expression.endsWith('*') || expression.endsWith('/') || expression.endsWith('^')) {
                    expression += '-';
                } else {
                    // Toggle sign of last number
                    let lastNum = '';
                    let i = expression.length - 1;
                    while (i >= 0 && /[\d.]/.test(expression[i])) {
                        lastNum = expression[i] + lastNum;
                        i--;
                    }
                    if (lastNum) {
                        expression = expression.substring(0, i + 1) + (lastNum[0] === '-' ? lastNum.substring(1) : '-' + lastNum);
                    }
                }
            } else if (num === '.') {
                // Only add decimal if last token doesn't have one
                let lastToken = getLastToken();
                if (!lastToken.includes('.') && /^\d*$/.test(lastToken)) {
                    expression += num;
                }
            } else {
                expression += num;
            }
            updateDisplay();
        }
        
        // Append Operator
        function appendOperator(op) {
            if (expression === '') return;
            
            // Auto-close open parenthesis if needed
            let openCount = (expression.match(/\(/g) || []).length;
            let closeCount = (expression.match(/\)/g) || []).length;
            let needsClosing = openCount - closeCount;
            
            if (needsClosing > 0) {
                expression += ')'.repeat(needsClosing);
            }
            
            // Prevent multiple operators
            let lastChar = expression[expression.length - 1];
            if (['+', '-', '*', '/', '^'].includes(lastChar)) {
                expression = expression.substring(0, expression.length - 1) + op;
            } else {
                expression += op;
            }
            updateDisplay();
        }
        
        // Append Function
        function appendFunction(func) {
            if (func === '!') {
                expression += '!';
            } else if (func === 'rad' || func === 'deg') {
                // For conversion functions, wrap the current expression or last value
                if (expression === '') {
                    alert('Masukkan nilai terlebih dahulu!');
                    return;
                }
                // Wrap last number or expression in conversion function
                expression = func + '(' + expression + ')';
            } else {
                expression += func + '(';
            }
            updateDisplay();
        }
        
        // Append Constant
        function appendConstant(constant) {
            let value = constant === 'œÄ' ? Math.PI : Math.E;
            expression += value;
            updateDisplay();
        }
        
        // Get Last Token
        function getLastToken() {
            const operators = ['+', '-', '*', '/', '^', '(', ')'];
            let lastToken = '';
            for (let i = expression.length - 1; i >= 0; i--) {
                if (operators.includes(expression[i])) {
                    break;
                }
                lastToken = expression[i] + lastToken;
            }
            return lastToken;
        }
        
        // Delete Last Character
        function deleteLastChar() {
            expression = expression.slice(0, -1);
            updateDisplay();
        }
        
        // Clear Display
        function clearDisplay() {
            expression = '';
            updateDisplay();
        }
        
        // Toggle Mode (Radian/Degree)
        function toggleMode() {
            isRadianMode = !isRadianMode;
            updateDisplay();
        }
        
        // Update Display
        function updateDisplay() {
            const exprElement = document.getElementById('expression');
            const resultElement = document.getElementById('result');
            const exprElementMobile = document.getElementById('expression-mobile');
            const resultElementMobile = document.getElementById('result-mobile');
            
            if (exprElement) exprElement.textContent = expression || '0';
            if (exprElementMobile) exprElementMobile.textContent = expression || '0';
            
            if (resultElement) resultElement.textContent = '0';
            if (resultElementMobile) resultElementMobile.textContent = '0';
        }
        
        // Calculate Result
        function calculate() {
            try {
                let expr = expression;
                
                // Validate expression
                if (!expr || expr.trim() === '') {
                    alert('Masukkan ekspresi terlebih dahulu!');
                    return;
                }
                
                // Auto-close any open parenthesis
                let openCount = (expr.match(/\(/g) || []).length;
                let closeCount = (expr.match(/\)/g) || []).length;
                let needsClosing = openCount - closeCount;
                if (needsClosing > 0) {
                    expr += ')'.repeat(needsClosing);
                }
                
                // Replace functions with JavaScript equivalents
                expr = expr.replace(/sin\(/g, 'sin(');
                expr = expr.replace(/cos\(/g, 'cos(');
                expr = expr.replace(/tan\(/g, 'tan(');
                expr = expr.replace(/sqrt\(/g, 'sqrt(');
                expr = expr.replace(/log\(/g, 'log(');
                expr = expr.replace(/ln\(/g, 'ln(');
                expr = expr.replace(/inv\(/g, 'inv(');
                
                // Handle rad and deg conversions
                expr = expr.replace(/rad\(/g, 'toRad(');
                expr = expr.replace(/deg\(/g, 'toDeg(');
                
                // Replace ^ with **
                expr = expr.replace(/\^/g, '**');
                
                // Handle factorial - match digits followed by !
                expr = expr.replace(/(\d+)!/g, 'factorial($1)');
                
                // Replace œÄ and e with their values
                expr = expr.replace(/œÄ/g, '(' + Math.PI + ')');
                expr = expr.replace(/e(?![a-zA-Z])/g, '(' + Math.E + ')');
                
                // Define the evaluation function
                const isRadian = isRadianMode;
                const degToRad = Math.PI / 180;
                
                const sin = (x) => Math.sin(isRadian ? x : x * degToRad);
                const cos = (x) => Math.cos(isRadian ? x : x * degToRad);
                const tan = (x) => Math.tan(isRadian ? x : x * degToRad);
                const sqrt = (x) => Math.sqrt(x);
                const log = (x) => Math.log10(x);
                const ln = (x) => Math.log(x);
                const toRad = (x) => x * Math.PI / 180;
                const toDeg = (x) => x * 180 / Math.PI;
                const inv = (x) => 1 / x;
                const factorial = (n) => {
                    n = Math.floor(n);
                    if (n < 0) return NaN;
                    if (n === 0 || n === 1) return 1;
                    let result = 1;
                    for (let i = 2; i <= n; i++) result *= i;
                    return result;
                };
                
                // Evaluate the expression using Function constructor
                const evalFunc = new Function('sin', 'cos', 'tan', 'sqrt', 'log', 'ln', 'toRad', 'toDeg', 'inv', 'factorial', 'return ' + expr);
                const result = evalFunc(sin, cos, tan, sqrt, log, ln, toRad, toDeg, inv, factorial);
                
                // Check if result is valid
                if (isNaN(result)) {
                    alert('Error: Hasil perhitungan tidak valid (NaN)!');
                    return;
                }
                
                if (!isFinite(result)) {
                    alert('Error: Hasil perhitungan tidak terbatas (Infinity)!');
                    return;
                }
                
                // Add to history
                const displayResult = Math.round(result * 100000000) / 100000000;
                addToHistory(expression + ' = ' + displayResult);
                
                expression = displayResult.toString();
                
                // Update result display
                const resultElement = document.getElementById('result');
                const resultElementMobile = document.getElementById('result-mobile');
                if (resultElement) resultElement.textContent = displayResult;
                if (resultElementMobile) resultElementMobile.textContent = displayResult;
                
            } catch (error) {
                console.error('Calculation error:', error);
                alert('Error: ' + error.message);
            }
        }
        
        // Add to History
        function addToHistory(entry) {
            calculationHistory.unshift(entry);
            if (calculationHistory.length > 20) {
                calculationHistory.pop();
            }
            saveHistory();
            updateHistoryDisplay();
        }
        
        // Toggle History Panel
        function toggleHistory() {
            const panel = document.getElementById('historyPanel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }
        
        // Update History Display
        function updateHistoryDisplay() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = calculationHistory
                .map((item, index) => `
                    <div style="padding: 8px; background: #2a2a2a; margin: 5px 0; border-radius: 4px; font-size: 12px; cursor: pointer;" onclick="useFromHistory('${item.split(' = ')[0]}')">
                        ${item}
                    </div>
                `)
                .join('');
        }
        
        // Use from History
        function useFromHistory(expr) {
            expression = expr;
            updateDisplay();
            document.getElementById('historyPanel').style.display = 'none';
        }
        
        // Save History to LocalStorage
        function saveHistory() {
            localStorage.setItem('calcHistory', JSON.stringify(calculationHistory));
        }
        
        // Load History from LocalStorage
        function loadHistory() {
            const saved = localStorage.getItem('calcHistory');
            if (saved) {
                calculationHistory = JSON.parse(saved);
                updateHistoryDisplay();
            }
        }
        
        // Clear History
        function clearHistory() {
            calculationHistory = [];
            localStorage.removeItem('calcHistory');
            updateHistoryDisplay();
        }
        
        // Detect device and show appropriate view
        const ua = navigator.userAgent.toLowerCase();
        if (ua.includes("android")) {
            document.querySelector(".android").style.display = "block";
        } else if (ua.includes("windows") || !ua.includes("android")) {
            // Show Windows version for desktop browsers
            if (!document.querySelector(".windows").style.display) {
                document.querySelector(".windows").style.display = "block";
            }
        }
    </script>
</body>
</html>